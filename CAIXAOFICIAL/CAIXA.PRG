***********************************************************************
* FLUXO DE CAIXA
* ADILSON JOSE ANGOLINI
* 05/2003
* 01/2004 MANUTENCAO
***********************************************************************
SET PROCEDURE TO PROCED
SET SOFTSEEK ON
SET DELETED ON
SET SCOREBOARD OFF
SET DATE BRITI
SET CENTURY ON
SET BELL OFF
SET MESSAGE TO 24 CENTER
***********************************************************************
MENSAG ('AGUARDE. ABRINDO ARQUIVOS.',24)
SELE 1
IF .NOT. FILE("CAIXA.DBF")
   DECLARE VETOR[05]
   VETOR[1]= "DATA      D"
   VETOR[2]= "GRUPO     C 015"
   VETOR[3]= "HISTORICO C 030"
   VETOR[4]= "COMPL     C 025"
   VETOR[5]= "VALOR     N 010 02"
   CREATE ARQ.$$$
   FOR M->WIND = 1 TO 5
      APPEND BLANK
      REPLACE FIELD_NAME WITH SUBSTR(VETOR[M->WIND],1,10)
      REPLACE FIELD_TYPE WITH SUBSTR(VETOR[M->WIND],11,1)
      REPLACE FIELD_LEN  WITH VAL(SUBSTR(VETOR[M->WIND],13,3))
      REPLACE FIELD_DEC  WITH VAL(SUBSTR(VETOR[M->WIND],17,2))
   NEXT
   CREATE CAIXA.DBF FROM ARQ.$$$
   ERASE ARQ.$$$
ENDIF
IF .NOT. FILE ("CAIXA.NDX")
   USE CAIXA
   INDEX ON DTOS(DATA)+GRUPO TO CAIXA
ENDIF
IF .NOT. FILE ("CAIXA1.NDX")
   USE CAIXA
   INDEX ON GRUPO+DTOS(DATA) TO CAIXA1
ENDIF
USE CAIXA INDEX CAIXA, CAIXA1

IF .NOT. USED()
   MENSAG ('ARQUIVO EM USO POR OUTRO USUARIO...PRESSIONE QQ TECLA',24)
   INKEY(0)
   SET COLOR TO
   CLEAR
   CLOSE ALL
   RETURN
ENDIF

PACK

SELE 2
IF .NOT. FILE("CAIXAGRU.DBF")
   DECLARE VETOR[03]
   VETOR[1]= "GRUPO     C 015"
   VETOR[2]= "DESCRICAO C 030"
   VETOR[3]= "DEB_CRED  C 001"
   CREATE ARQ.$$$
   FOR M->WIND = 1 TO 3
      APPEND BLANK
      REPLACE FIELD_NAME WITH SUBSTR(VETOR[M->WIND],1,10)
      REPLACE FIELD_TYPE WITH SUBSTR(VETOR[M->WIND],11,1)
      REPLACE FIELD_LEN  WITH VAL(SUBSTR(VETOR[M->WIND],13,3))
      REPLACE FIELD_DEC  WITH VAL(SUBSTR(VETOR[M->WIND],17,2))
   NEXT
   CREATE CAIXAGRU.DBF FROM ARQ.$$$
   ERASE ARQ.$$$
ENDIF
IF .NOT. FILE ("CAIXAGRU.NDX")
   USE CAIXAGRU
   INDEX ON GRUPO TO CAIXAGRU
ENDIF
IF .NOT. FILE ("CAIXAGDC.NDX")
   USE CAIXAGRU
   INDEX ON DEB_CRED TO CAIXAGDC
ENDIF
USE CAIXAGRU INDEX CAIXAGRU, CAIXAGDC
PACK

SELE 3
IF .NOT. FILE("CAIXACOL.DBF")
   DECLARE VETOR[24]
   VETOR[01]= "NOME      C 030"
   VETOR[02]= "VINCULO   C 001"
   VETOR[03]= "RESPONS   C 015"
   VETOR[04]= "DOC1      C 025"
   VETOR[05]= "DOC2      C 025"
   VETOR[06]= "ENDERECO  C 030"
   VETOR[07]= "BAIRRO    C 020"
   VETOR[08]= "CIDADE    C 025"
   VETOR[09]= "CEP       C 009"
   VETOR[10]= "TELEFONE  C 015"
   VETOR[11]= "EMAIL     C 030"
   VETOR[12]= "PAROQUIA  C 015"
   VETOR[13]= "VALOR     N 010 02"
   VETOR[14]= "DIA       C 002"
   VETOR[15]= "DATA      D"
   VETOR[16]= "UF        C 002"
   VETOR[17]= "NUMERO    N 005"
   VETOR[18]= "ATIVO     C 001"
   VETOR[19]= "REGIAO    N 003"
   VETOR[20]= "FORMA_PGTOC 001"
   VETOR[21]= "ULT_PGTO  D"
   VETOR[22]= "RECEBEDOR N 003"
   VETOR[23]= "OBS       C 040"
   VETOR[24]= "DATA_NASC D"
   CREATE ARQ.$$$
   FOR M->WIND = 1 TO 24
      APPEND BLANK
      REPLACE FIELD_NAME WITH SUBSTR(VETOR[M->WIND],1,10)
      REPLACE FIELD_TYPE WITH SUBSTR(VETOR[M->WIND],11,1)
      REPLACE FIELD_LEN  WITH VAL(SUBSTR(VETOR[M->WIND],13,3))
      REPLACE FIELD_DEC  WITH VAL(SUBSTR(VETOR[M->WIND],17,2))
   NEXT
   CREATE CAIXACOL.DBF FROM ARQ.$$$
   ERASE ARQ.$$$
ENDIF
IF .NOT. FILE ("CAIXACNO.NDX")
   USE CAIXACOL
   INDEX ON NOME TO CAIXACNO
ENDIF
IF .NOT. FILE ("CAIXACRE.NDX")
   USE CAIXACOL
   INDEX ON STR(REGIAO,3,0)+ENDERECO+STR(NUMERO,5,0) TO CAIXACRE
ENDIF
IF .NOT. FILE ("CAIXACNU.NDX")
   USE CAIXACOL
   INDEX ON STR(NUMERO,5,0) TO CAIXACNU
ENDIF
USE CAIXACOL INDEX CAIXACNO, CAIXACRE, CAIXACNU
PACK

SELE 4
IF .NOT. FILE("CAIXAREG.DBF")
   DECLARE VETOR[02]
   VETOR[1]= "REGIAO    N 003"
   VETOR[2]= "DESCRICAO C 025"
   CREATE ARQ.$$$
   FOR M->WIND = 1 TO 2
      APPEND BLANK
      REPLACE FIELD_NAME WITH SUBSTR(VETOR[M->WIND],1,10)
      REPLACE FIELD_TYPE WITH SUBSTR(VETOR[M->WIND],11,1)
      REPLACE FIELD_LEN  WITH VAL(SUBSTR(VETOR[M->WIND],13,3))
      REPLACE FIELD_DEC  WITH VAL(SUBSTR(VETOR[M->WIND],17,2))
   NEXT
   CREATE CAIXAREG.DBF FROM ARQ.$$$
   ERASE ARQ.$$$
ENDIF
IF .NOT. FILE ("CAIXAREG.NDX")
   USE CAIXAREG
   INDEX ON STR(REGIAO,3,0) TO CAIXAREG
ENDIF
USE CAIXAREG INDEX CAIXAREG
PACK

SELE 5
IF .NOT. FILE("CAIXABAL.DBF")
   DECLARE VETOR[01]
   VETOR[1]= "REGISTRO  C 080"
   CREATE ARQ.$$$
   FOR M->WIND = 1 TO 1
      APPEND BLANK
      REPLACE FIELD_NAME WITH SUBSTR(VETOR[M->WIND],1,10)
      REPLACE FIELD_TYPE WITH SUBSTR(VETOR[M->WIND],11,1)
      REPLACE FIELD_LEN  WITH VAL(SUBSTR(VETOR[M->WIND],13,3))
      REPLACE FIELD_DEC  WITH VAL(SUBSTR(VETOR[M->WIND],17,2))
   NEXT
   CREATE CAIXABAL.DBF FROM ARQ.$$$
   ERASE ARQ.$$$
ENDIF
USE CAIXABAL
PACK

SELE 6
IF .NOT. FILE("CAIXAREC.DBF")
   DECLARE VETOR[02]
   VETOR[1]= "RECEBEDOR N 003"
   VETOR[2]= "NOME      C 025"
   CREATE ARQ.$$$
   FOR M->WIND = 1 TO 2
      APPEND BLANK
      REPLACE FIELD_NAME WITH SUBSTR(VETOR[M->WIND],1,10)
      REPLACE FIELD_TYPE WITH SUBSTR(VETOR[M->WIND],11,1)
      REPLACE FIELD_LEN  WITH VAL(SUBSTR(VETOR[M->WIND],13,3))
      REPLACE FIELD_DEC  WITH VAL(SUBSTR(VETOR[M->WIND],17,2))
   NEXT
   CREATE CAIXAREC.DBF FROM ARQ.$$$
   ERASE ARQ.$$$
ENDIF
IF .NOT. FILE ("CAIXAREC.NDX")
   USE CAIXAREC
   INDEX ON STR(RECEBEDOR,3,0) TO CAIXAREC
ENDIF
USE CAIXAREC INDEX CAIXAREC
PACK

MENSAG ('',24)
****************************************************************************
CLEAR
SET COLOR TO 15/2
M->WBORDA = '±±±±±±±±±'
@ 01,00,23,79  BOX(M->WBORDA)
SET COLOR TO 14/3
@ 00,00 SAY SPACE(80)
@ 00,19 SAY "COMUNIDADE CORPUS CHRISTI - FLUXO DE CAIXA V5.1"
SET COLOR TO 15/7,15/1
@ 24,00 SAY 'DIGITE A SENHA DO SISTEMA  '
M->WSENHA = ''
M->WCOL = 27
FOR I = 1 TO 5
   M->WTECLA = INKEY(0)
   IF M->WTECLA = 13
      EXIT
   ENDIF
   M->WSENHA = M->WSENHA + CHR(M->WTECLA)
   @ 24,M->WCOL SAY '*'
   M->M->WCOL = M->WCOL + 1
NEXT
IF M->WSENHA <> 'CAIXA'
   SET COLOR TO
   CLEAR
   CLOSE ALL
   RETURN
ENDIF
@ 24,00 SAY SPACE(80)
DO CADASTRO
****************************************************************************
PROCEDURE CADASTRO
SELE 1
SET ORDER TO 1
DECLARE VETOR1[4]
VETOR1[1]='DATA'
VETOR1[2]='GRUPO'
VETOR1[3]="HISTORICO"
VETOR1[4]="VALOR"
DECLARE VETOR2[4]
VETOR2[1]=''
VETOR2[2]='@!'
VETOR2[3]='@!'
VETOR2[4]='@E 9,999,999.99'
DECLARE VETOR3[4]
VETOR3[1]='DATA'
VETOR3[2]='GRUPO'
VETOR3[3]="HISTORICO"
VETOR3[4]="VALOR"
QUADRO (02,01,22,78,'NAO')
SET COLOR TO 11/4
@ 02,03 SAY '¹ ORDEM DE DATA  Ì'
SET COLOR TO 15/7,15/1
DO WHILE .T.
   DBEDIT (03,02,21,77,VETOR1,"CAIXACAD",VETOR2,VETOR3,'Í')
   IF CONFIRMA ("DESEJA ENCERRAR A EXECUCAO DO PROGRAMA ? <S/N>",24)
      EXIT
   ELSE
      MENSAG ("",24)
   ENDIF
ENDDO
SET COLOR TO
CLEAR
CLOSE ALL
RETURN
******************************************************************************
FUNCTION CAIXACAD
SET CURSOR ON
PARAMETERS MODO
IF MODO = 4
   IF LASTKEY()= 27
      RETURN 0
   ELSEIF LASTKEY() = 279 && INCLUSAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (05,16,11,63,'NAO')
      M->WDATA = DATE()
      M->WGRUPO = SPACE(15)
      M->WHISTORICO = SPACE(30)
      M->WCOMPL = SPACE(25)
      M->WVALOR = 0
      @ 06,18 SAY 'DATA.........' GET M->WDATA
      @ 07,18 SAY 'GRUPO........' GET M->WGRUPO PICT '@!' VALID(GRUPO(@WGRUPO,@WCOMPL))
      @ 08,18 SAY 'HISTORICO....' GET M->WHISTORICO PICT '@!' VALID(COLAB(WGRUPO,@WHISTORICO,@WCOMPL,@WVALOR))
      @ 09,18 SAY 'COMPLEMENTO..' GET M->WCOMPL PICT '@!'
      @ 10,18 SAY 'VALOR........' GET M->WVALOR PICT '@E 9,999,999.99' VALID(M->WVALOR > 0)
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      APPEND BLANK
      REPLACE DATA WITH M->WDATA, GRUPO WITH M->WGRUPO, HISTORICO WITH M->WHISTORICO, COMPL WITH M->WCOMPL, VALOR WITH M->WVALOR
      IF GRUPO='MENSAL ASSOC'
         SELE 3
         SET ORDER TO 1
         SEEK M->WHISTORICO
         REPLACE ULT_PGTO WITH M->WDATA
         SELE 1
      ENDIF
      COMMIT
      MENSAG ("INCLUSAO EFETUADA",24)
      RETURN 2
   ELSEIF LASTKEY() = 289 && INCLUSAO MENSALIDADE
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (05,16,11,63,'NAO')
      M->WDATA = DATE()
      M->WGRUPO = "MENSAL ASSOC   "
      M->WHISTORICO = SPACE(30)
      M->WCOMPL = SPACE(25)
      M->WVALOR = 0
      @ 06,18 SAY 'DATA.........' GET M->WDATA
      @ 07,18 SAY 'GRUPO........' GET M->WGRUPO PICT '@!' VALID(GRUPO(@WGRUPO,@WCOMPL))
      @ 08,18 SAY 'HISTORICO....' GET M->WHISTORICO PICT '@!' VALID(COLAB(WGRUPO,@WHISTORICO,@WCOMPL,@WVALOR))
      @ 09,18 SAY 'COMPLEMENTO..' GET M->WCOMPL PICT '@!'
      @ 10,18 SAY 'VALOR........' GET M->WVALOR PICT '@E 9,999,999.99' VALID(M->WVALOR > 0)
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      APPEND BLANK
      REPLACE DATA WITH M->WDATA, GRUPO WITH M->WGRUPO, HISTORICO WITH M->WHISTORICO, COMPL WITH M->WCOMPL, VALOR WITH M->WVALOR
      IF GRUPO='MENSAL ASSOC'
         SELE 3
         SET ORDER TO 1
         SEEK M->WHISTORICO
         REPLACE ULT_PGTO WITH M->WDATA
         SELE 1
      ENDIF
      COMMIT
      MENSAG ("INCLUSAO EFETUADA",24)
      RETURN 2
   ELSEIF LASTKEY() = 286 && ALTERACAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (05,16,11,63,'NAO')
      M->WDATA=DATA
      M->WGRUPO=GRUPO
      M->WHISTORICO=HISTORICO
      M->WCOMPL=COMPL
      M->WVALOR=VALOR
      @ 06,18 SAY 'DATA.........' GET M->WDATA
      @ 07,18 SAY 'GRUPO........' GET M->WGRUPO PICT '@!' VALID(GRUPO(@WGRUPO))
      @ 08,18 SAY 'HISTORICO....' GET M->WHISTORICO PICT '@!'
      @ 09,18 SAY 'COMPLEMENTO..' GET M->WCOMPL PICT '@!'
      @ 10,18 SAY 'VALOR........' GET M->WVALOR PICT '@E 9,999,999.99' VALID(M->WVALOR > 0)
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      REPLACE DATA WITH M->WDATA, GRUPO WITH M->WGRUPO, HISTORICO WITH M->WHISTORICO, COMPL WITH M->WCOMPL, VALOR WITH M->WVALOR
      COMMIT
      MENSAG ("ALTERACAO EFETUADA",24)
      RETURN 2
   ELSEIF LASTKEY() = 276 && ALT+T - TROCAR INDICE
      IF INDEXORD() = 1
         SET ORDER TO 2
         SET COLOR TO 11/4
         @ 02,03 SAY '¹ ORDEM DE GRUPO Ì'
         SET COLOR TO 15/7,15/1
      ELSEIF INDEXORD() = 2
         SET ORDER TO 1
         SET COLOR TO 11/4
         @ 02,03 SAY '¹ ORDEM DE DATA  Ì'
         SET COLOR TO 15/7,15/1
      ENDIF
      GO TOP
      RETURN 2
   ELSEIF LASTKEY() = 281 && PESQUISA
      QUADRO (08,18,10,49,'NAO')
      IF INDEXORD() = 1
         M->WDATA = CTOD('  /  /    ')
         @ 09,20 SAY 'DATA......: ' GET M->WDATA
         READ
         SEEK DTOS(M->WDATA)
      ELSEIF INDEXORD() = 2
         M->WGRUPO = SPACE(15)
         @ 09,20 SAY 'GRUPO.....: ' GET M->WGRUPO PICT '@!'
         READ
         SEEK M->WGRUPO
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 274 && EXCLUSAO
      IF CONFIRMA ('CONFIRMA EXCLUSAO ? <S/N>',24)
         DELE
         COMMIT
         MENSAG ("EXCLUSAO EFETUADA",24)
      ELSE
         MENSAG ('',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 28 && F1 - HELP
      MENSAG ('',24)
      QUADRO (06,18,16,62,"NAO")
      @ 07,20 SAY "ALT+I - INCLUIR"
      @ 08,20 SAY 'ALT+A - ALTERAR'
      @ 09,20 SAY 'ALT+E - EXCLUIR'
      @ 10,20 SAY "ALT+P - PESQUISAR"
      @ 11,20 SAY "ALT+T - TROCA INDICE"
      @ 12,20 SAY "ALT+L - COLABORADORES"
      @ 13,20 SAY "ALT+N - BALANC. TELA"
      @ 14,20 SAY "ALT+M - IMPORTACAO"
      @ 15,20 SAY "ALT+H - RECEBEDORES"
      @ 07,42 SAY "ALT+S - SALDO"
      @ 08,42 SAY "ALT+R - DIARIO"
      @ 09,42 SAY "ALT+B - BALANCETE"
      @ 10,42 SAY "ALT+O - DOACOES"
      @ 11,42 SAY "ALT+G - GRUPOS"
      @ 12,42 SAY "ALT+V - REGIOES"
      @ 13,42 SAY "ALT+X - EXPORTACAO"
      @ 14,42 SAY "ALT+F - INC. MENSAL."
      MENSAG ("TECLE ALGO PARA CONTINUAR",24)
      INKEY(0)
      MENSAG ('',24)
      RETURN 2
   ELSEIF LASTKEY() = 287 && ALT+S - SALDO
      M->WSALDO=0
      M->WDATAINI = CTOD('01/'+SUBSTR(DTOC(DATE()),4,7))
      M->WDATAFIM = M->WDATAINI + 26
      M->WMES = SUBSTR(DTOC(M->WDATAFIM),4,2)
      DO WHILE SUBSTR(DTOC(M->WDATAFIM),4,2) = M->WMES
         M->WDATAFIM = M->WDATAFIM + 1
      ENDDO
      M->WDATAFIM = M->WDATAFIM - 1
      QUADRO (08,18,12,56,'NAO')
      @ 09,20 SAY "ENTRE COM A DATA INICIAL" GET M->WDATAINI
      @ 10,20 SAY "ENTRE COM A DATA FINAL  " GET M->WDATAFIM
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SET ORDER TO 1
      SET COLOR TO 11/4
      @ 02,03 SAY '¹ ORDEM DE DATA  Ì'
      SET COLOR TO 15/7,15/1
      SEEK DTOS(M->WDATAINI)
      DO WHILE DATA <= M->WDATAFIM
         M->WGRUPO = GRUPO
         SELE 2
         SET ORDER TO 1
         SEEK M->WGRUPO
         M->WDEB_CRED = DEB_CRED
         SELE 1
         IF M->WDEB_CRED='C'
            M->WSALDO = M->WSALDO + VALOR
         ELSE
            M->WSALDO = M->WSALDO - VALOR
         ENDIF
         SKIP
         IF EOF()
            EXIT
         ENDIF
      ENDDO
      @ 11,20 SAY 'SALDO                 ' GET M->WSALDO PICT '@E 9,999,999.99'
      CLEAR GETS
      MENSAG ("TECLE ALGO PARA CONTINUAR",24)
      INKEY(0)
      MENSAG ('',24)
      SEEK DTOS(M->WDATAINI)
      RETURN 2
   ELSEIF LASTKEY() = 290 && ALT+G - CADASTRO DE GRUPOS
      SELE 2
      SET ORDER TO 1
      DECLARE VETOR4[3]
      VETOR4[1]='GRUPO'
      VETOR4[2]='DESCRICAO'
      VETOR4[3]='DEB_CRED'
      DECLARE VETOR5[3]
      VETOR5[1]='@!'
      VETOR5[2]='@!'
      VETOR5[3]='@!'
      DECLARE VETOR6[3]
      VETOR6[1]='GRUPO'
      VETOR6[2]='DESCRICAO'
      VETOR6[3]='DEB/CRED'
      QUADRO (05,04,21,75,'NAO')
      DBEDIT (06,05,20,74,VETOR4,"GRUPOCAD",VETOR5,VETOR6,'Í')
      SELE 1
      RETURN 2
   ELSEIF LASTKEY() = 303 && ALT+F - CADASTRO DE REGIOES
      SELE 4
      SET ORDER TO 1
      DECLARE VETOR4[2]
      VETOR4[1]='REGIAO'
      VETOR4[2]='DESCRICAO'
      DECLARE VETOR5[2]
      VETOR5[1]='999'
      VETOR5[2]='@!'
      DECLARE VETOR6[2]
      VETOR6[1]='REGIAO'
      VETOR6[2]='DESCRICAO'
      QUADRO (05,04,21,75,'NAO')
      DBEDIT (06,05,20,74,VETOR4,"GRUPOREG",VETOR5,VETOR6,'Í')
      SELE 1
      RETURN 2
   ELSEIF LASTKEY() = 291 && ALT+H - CADASTRO DE RECEBEDORES
      SELE 6
      SET ORDER TO 1
      DECLARE VETOR4[2]
      VETOR4[1]='RECEBEDOR'
      VETOR4[2]='NOME'
      DECLARE VETOR5[2]
      VETOR5[1]='999'
      VETOR5[2]='@!'
      DECLARE VETOR6[2]
      VETOR6[1]='RECEBEDOR'
      VETOR6[2]='NOME'
      QUADRO (05,04,21,75,'NAO')
      DBEDIT (06,05,20,74,VETOR4,"GRUPOREC",VETOR5,VETOR6,'Í')
      SELE 1
      RETURN 2
   ELSEIF LASTKEY() = 294 && ALT+L - CADASTRO DE COLABORADORES
      SELE 3
      SET ORDER TO 1
      DECLARE VETOR4[3]
      VETOR4[1]='NOME'
      VETOR4[2]='NUMERO'
      VETOR4[3]='REGIAO'
      DECLARE VETOR5[3]
      VETOR5[1]='@!'
      VETOR5[2]='99999'
      VETOR5[3]='999'
      DECLARE VETOR6[3]
      VETOR6[1]='NOME'
      VETOR6[2]='NUMERO'
      VETOR6[3]='REGIAO'
      QUADRO (05,04,21,75,'NAO')
      SET COLOR TO 11/4
      @ 05,06 SAY '¹ ORDEM DE NOME  Ì'
      SET COLOR TO 15/7,15/1
      DBEDIT (06,05,20,74,VETOR4,"GRUPOCOLAB",VETOR5,VETOR6,'Í')
      SELE 1
      RETURN 2
   ELSEIF LASTKEY() = 304 && ALT+B - LISTAGEM DO BALANCETE
      M->WDATAINI = CTOD('01/'+SUBSTR(DTOC(DATE()),4,7))
      M->WDATAFIM = M->WDATAINI + 26
      M->WMES = SUBSTR(DTOC(M->WDATAFIM),4,2)
      DO WHILE SUBSTR(DTOC(M->WDATAFIM),4,2) = M->WMES
         M->WDATAFIM = M->WDATAFIM + 1
      ENDDO
      M->WDATAFIM = M->WDATAFIM - 1
      QUADRO (08,18,11,56,'NAO')
      @ 09,20 SAY "ENTRE COM A DATA INICIAL" GET M->WDATAINI
      @ 10,20 SAY "ENTRE COM A DATA FINAL  " GET M->WDATAFIM
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SET ORDER TO 1
      SEEK DTOS(M->WDATAINI)+'SALDO ANTERIOR'
      M->WSALDOANT = VALOR
      M->WSALDOAT = M->WSALDOANT
      M->WTOT_ENT = 0
      M->WTOT_SAIDA = 0
      SET ORDER TO 2
      SET COLOR TO 11/4
      @ 02,03 SAY '¹ ORDEM DE GRUPO Ì'
      SET COLOR TO 15/7,15/1
      M->WIMP = ''
      IF .NOT. IMP(24,@WIMP)
         MENSAG ("",24)
         RETURN 2
      ENDIF
      MENSAG ("AGUARDE TERMINO DE IMPRESSAO",24)
      M->WLIN = 65
      M->WPAG = 1
      * SET PRINTER TO &WIMP
      SET DEVICE TO PRINT
      SETPRC(0,0)
      SELE 2
      SET ORDER TO 2
      GO TOP
      DO WHILE .NOT. EOF()
         IF GRUPO = 'SALDO ANTERIOR'
            SKIP
            LOOP
         ENDIF
         IF M->WLIN > 59
            M->WTITULO = 'ASSOCIACAO CORPUS CHRISTI - BALANCETE'
            M->WTAM = LEN(M->WTITULO)
            @ 01,05 SAY DATE()
            @ 01,INT((132-M->WTAM)/2) SAY M->WTITULO
            @ 01,120 SAY 'PAG: '+STR(M->WPAG,2,0)
            @ 02,51 SAY 'DE: '+DTOC(M->WDATAINI)+ ' ATE: '+DTOC(M->WDATAFIM)
            IF M->WPAG=1
               @ 04,43 SAY 'SALDO ANTERIOR'
               @ 04,63 SAY M->WSALDOANT PICT '@E 9,999,999.99'
               M->WLIN = 6
            ELSE
               M->WLIN = 4
            ENDIF
            @ M->WLIN,05 SAY 'GRUPO'
            @ M->WLIN,41 SAY 'ENTRADAS'
            @ M->WLIN,56 SAY 'SAIDAS'
            M->WLIN = M->WLIN + 2
            M->WPAG = M->WPAG + 1
         ENDIF
         M->WGRUPO=GRUPO
         M->WTOTAL=0
         SELE 1
         SET ORDER TO 2
         SEEK M->WGRUPO+DTOS(M->WDATAINI)
         DO WHILE GRUPO = M->WGRUPO .AND. DATA <= M->WDATAFIM
            M->WTOTAL = M->WTOTAL+VALOR
            SKIP
            IF EOF()
               EXIT
            ENDIF
         ENDDO
         SELE 2
         IF M->WTOTAL > 0
            @ M->WLIN,05 SAY DESCRICAO
            IF DEB_CRED='C'
               M->WSALDOAT = M->WSALDOAT + M->WTOTAL
               M->WTOT_ENT = M->WTOT_ENT + M->WTOTAL
               @ M->WLIN,37 SAY M->WTOTAL PICT '@E 9,999,999.99'
            ELSE
               M->WSALDOAT = M->WSALDOAT - M->WTOTAL
               M->WTOT_SAIDA = M->WTOT_SAIDA + M->WTOTAL
               @ M->WLIN,50 SAY M->WTOTAL PICT '@E 9,999,999.99'
            ENDIF
            M->WLIN = M->WLIN+1
         ENDIF
         SKIP
      ENDDO
      @ M->WLIN+1,05 SAY 'TOTAIS'
      @ M->WLIN+1,37 SAY M->WTOT_ENT PICT '@E 9,999,999.99'
      @ M->WLIN+1,50 SAY M->WTOT_SAIDA PICT '@E 9,999,999.99'
      @ M->WLIN+3,43 SAY 'SALDO EM '+DTOC(M->WDATAFIM)
      @ M->WLIN+3,63 SAY M->WSALDOAT PICT '@E 9,999,999.99'
      EJECT
      SET DEVICE TO SCREEN
      SELE 2
      SET ORDER TO 1
      MENSAG ("",24)
      SELE 1
      SET ORDER TO 2
      SEEK  DTOS(M->WDATAINI)
      RETURN 2
   ELSEIF LASTKEY() = 305 && ALT+N - BALANCETE NA TELA
      M->WDATAINI = CTOD('01/'+SUBSTR(DTOC(DATE()),4,7))
      M->WDATAFIM = M->WDATAINI + 26
      M->WMES = SUBSTR(DTOC(M->WDATAFIM),4,2)
      DO WHILE SUBSTR(DTOC(M->WDATAFIM),4,2) = M->WMES
         M->WDATAFIM = M->WDATAFIM + 1
      ENDDO
      M->WDATAFIM = M->WDATAFIM - 1
      QUADRO (08,18,11,56,'NAO')
      @ 09,20 SAY "ENTRE COM A DATA INICIAL" GET M->WDATAINI
      @ 10,20 SAY "ENTRE COM A DATA FINAL  " GET M->WDATAFIM
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SET ORDER TO 1
      SEEK DTOS(M->WDATAINI)+'SALDO ANTERIOR'
      M->WSALDOANT = VALOR
      M->WSALDOAT = M->WSALDOANT
      M->WTOT_ENT = 0
      M->WTOT_SAIDA = 0
      SET ORDER TO 2
      SET COLOR TO 11/4
      @ 02,03 SAY '¹ ORDEM DE GRUPO Ì'
      SET COLOR TO 15/7,15/1
      MENSAG ("AGUARDE...",24)
      SELE 5
      ZAP
      APPEND BLANK
      REPLACE REGISTRO WITH '                                         DE '+DTOC(M->WDATAINI)+ ' ATE '+DTOC(M->WDATAFIM)
      APPEND BLANK
      REPLACE REGISTRO WITH 'SALDO ANTERIOR         '+TRANSFORM(M->WSALDOANT,'@E 9,999,999.99')
      APPEND BLANK
      APPEND BLANK
      REPLACE REGISTRO WITH 'GRUPO                                    ENTRADAS          SAIDAS'
      APPEND BLANK
      SELE 2
      SET ORDER TO 2
      GO TOP
      DO WHILE .NOT. EOF()
         IF GRUPO = 'SALDO ANTERIOR'
            SKIP
            LOOP
         ENDIF
         M->WDEB_CRED=DEB_CRED
         M->WDESCRICAO=DESCRICAO
         M->WGRUPO=GRUPO
         M->WTOTAL=0
         SELE 1
         SET ORDER TO 2
         SEEK M->WGRUPO+DTOS(M->WDATAINI)
         DO WHILE GRUPO = M->WGRUPO .AND. DATA <= M->WDATAFIM
            M->WTOTAL = M->WTOTAL+VALOR
            SKIP
            IF EOF()
               EXIT
            ENDIF
         ENDDO
         SELE 2
         IF M->WTOTAL > 0
            SELE 5
            IF M->WDEB_CRED='C'
               M->WSALDOAT = M->WSALDOAT + M->WTOTAL
               M->WTOT_ENT = M->WTOT_ENT + M->WTOTAL
               APPEND BLANK
               REPLACE REGISTRO WITH M->WDESCRICAO+'       '+TRANSFORM(M->WTOTAL,'@E 9,999,999.99')
            ELSE
               M->WSALDOAT = M->WSALDOAT - M->WTOTAL
               M->WTOT_SAIDA = M->WTOT_SAIDA + M->WTOTAL
               APPEND BLANK
               REPLACE REGISTRO WITH M->WDESCRICAO+'                       '+TRANSFORM(M->WTOTAL,'@E 9,999,999.99')
            ENDIF
         ENDIF
         SELE 2
         SKIP
      ENDDO
      SELE 5
      APPEND BLANK
      APPEND BLANK
      REPLACE REGISTRO WITH 'TOTAIS                               '+TRANSFORM(M->WTOT_ENT,'@E 9,999,999.99')+'    '+TRANSFORM(M->WTOT_SAIDA,'@E 9,999,999.99')
      APPEND BLANK
      APPEND BLANK
      REPLACE REGISTRO WITH 'SALDO EM '+DTOC(M->WDATAFIM)+'    '+TRANSFORM(M->WSALDOAT,'@E 9,999,999.99')
      GO TOP
      DECLARE VETOR4[1]
      VETOR4[1]='REGISTRO'
      DECLARE VETOR5[1]
      VETOR5[1]='@!'
      DECLARE VETOR6[1]
      VETOR6[1]='            ASSOCIACAO CORPUS CHRISTI - BALANCETE'
      QUADRO (05,04,21,75,'NAO')
      MENSAG ("TECLE <ESC> PARA SAIR",24)
      DBEDIT (06,05,20,74,VETOR4,"GRUPOBAL",VETOR5,VETOR6,'Í')
      SELE 2
      SET ORDER TO 1
      MENSAG ("",24)
      SELE 1
      SET ORDER TO 2
      SEEK  DTOS(M->WDATAINI)
      RETURN 2
   ELSEIF LASTKEY() = 275 && ALT+R - LISTAGEM DO DIARIO
      M->WDATAINI = CTOD('01/'+SUBSTR(DTOC(DATE()),4,7))
      M->WDATAFIM = M->WDATAINI + 26
      M->WMES = SUBSTR(DTOC(M->WDATAFIM),4,2)
      DO WHILE SUBSTR(DTOC(M->WDATAFIM),4,2) = M->WMES
         M->WDATAFIM = M->WDATAFIM + 1
      ENDDO
      M->WDATAFIM = M->WDATAFIM - 1
      QUADRO (08,18,11,56,'NAO')
      @ 09,20 SAY "ENTRE COM A DATA INICIAL" GET M->WDATAINI
      @ 10,20 SAY "ENTRE COM A DATA FINAL  " GET M->WDATAFIM
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SET ORDER TO 1
      SET COLOR TO 11/4
      @ 02,03 SAY '¹ ORDEM DE DATA  Ì'
      SET COLOR TO 15/7,15/1
      SEEK DTOS(M->WDATAINI)+'SALDO ANTERIOR'
      M->WSALDOANT = VALOR
      M->WSALDOAT = M->WSALDOANT
      SEEK DTOS(M->WDATAINI)
      M->WIMP = ''
      IF .NOT. IMP(24,@WIMP)
         MENSAG ("",24)
         RETURN 2
      ENDIF
      MENSAG ("AGUARDE TERMINO DE IMPRESSAO",24)
      M->WLIN = 65
      M->WPAG = 1
      * SET PRINTER TO &WIMP
      SET DEVICE TO PRINT
      SETPRC(0,0)
      DO WHILE DATA <= M->WDATAFIM
         IF GRUPO = 'SALDO ANTERIOR'
            SKIP
            IF EOF()
               EXIT
            ENDIF
            LOOP
         ENDIF
         IF M->WLIN > 59
            M->WTITULO = 'ASSOCIACAO CORPUS CHRISTI - LIVRO DIARIO'
            M->WTAM = LEN(M->WTITULO)
            @ 01,05 SAY DATE()
            @ 01,INT((132-M->WTAM)/2) SAY M->WTITULO
            @ 01,120 SAY 'PAG: '+STR(M->WPAG,2,0)
            @ 02,51 SAY 'DE: '+DTOC(M->WDATAINI)+ ' ATE: '+DTOC(M->WDATAFIM)
            @ 04,05 SAY 'DATA'
            @ 04,16 SAY 'GRUPO'
            @ 04,32 SAY 'HISTORICO'
            @ 04,63 SAY 'COMPLEMENTO'
            @ 04,96 SAY 'VALOR'
            @ 04,102 SAY 'DC'
            IF M->WPAG=1
               @ 06,72 SAY 'SALDO ANTERIOR'
               @ 06,89 SAY M->WSALDOANT PICT '@E 9,999,999.99'
               M->WLIN = 7
            ELSE
               M->WLIN=6
            ENDIF
            M->WPAG = M->WPAG + 1
         ENDIF
         @ M->WLIN,05 SAY DATA
         @ M->WLIN,16 SAY GRUPO
         @ M->WLIN,32 SAY HISTORICO
         @ M->WLIN,63 SAY COMPL
         @ M->WLIN,89 SAY VALOR PICT '@E 9,999,999.99'
         M->WGRUPO = GRUPO
         SELE 2
         SET ORDER TO 1
         SEEK M->WGRUPO
         M->WDEB_CRED = DEB_CRED
         SELE 1
         IF M->WDEB_CRED='C'
            M->WSALDOAT = M->WSALDOAT + VALOR
         ELSE
            M->WSALDOAT = M->WSALDOAT - VALOR
         ENDIF
         @M->WLIN,102 SAY M->WDEB_CRED
         M->WLIN = M->WLIN+1
         SKIP
         IF EOF()
            EXIT
         ENDIF
      ENDDO
      @ M->WLIN,72 SAY 'SALDO ATUAL'
      @ M->WLIN,89 SAY M->WSALDOAT PICT '@E 9,999,999.99'
      EJECT
      SET DEVICE TO SCREEN
      MENSAG ("",24)
      SEEK  DTOS(M->WDATAINI)
      RETURN 2
   ELSEIF LASTKEY() = 301 && ALT+X - EXPORTACAO
      MENSAG ('TECLE <ENTER> P/ PROSSEGUIR COM A GRAVACAO',24)
      INKEY(0)
      IF LASTKEY() = 13
         MENSAG ('AGUARDE...',24)
         COPY TO CAIXABKP.DBF
         COPY TO C:\CAIXA.DBF
*         ZAP
         MENSAG ("EXPORTACAO EFETUADA. UTILIZE O ARQUIVO C:\CAIXA.DBF",24)
      ELSE
         MENSAG ('OPERACAO CANCELADA',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 306 && ALT+M - IMPORTACAO
      MENSAG ('O ARQUIVO <CAIXA.DBF> SE ENCONTRA NA UNIDADE <C:>? TECLE <ENTER> P/ PROSSEGUIR',24)
      INKEY(0)
      IF LASTKEY() = 13
         IF .NOT. FILE ("C:\CAIXA.DBF")
            MENSAG ('ARQUIVO DE IMPORTACAO NAO LOCALIZADO NA UNIDADE <C:>.',24)
            RETURN 2
         ENDIF
         MENSAG ('AGUARDE...',24)
         APPEND FROM C:\CAIXA.DBF
         MENSAG ('DADOS INCORPORADOS COM SUCESSO',24)
      ELSE
         MENSAG ('OPERACAO CANCELADA',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 280 && ALT+O - LISTAGEM DAS DOACOES
      M->WDATAINI = CTOD('01/'+SUBSTR(DTOC(DATE()),4,7))
      M->WDATAFIM = M->WDATAINI + 26
      M->WMES = SUBSTR(DTOC(M->WDATAFIM),4,2)
      DO WHILE SUBSTR(DTOC(M->WDATAFIM),4,2) = M->WMES
         M->WDATAFIM = M->WDATAFIM + 1
      ENDDO
      M->WDATAFIM = M->WDATAFIM - 1
      QUADRO (08,18,11,56,'NAO')
      @ 09,20 SAY "ENTRE COM A DATA INICIAL" GET M->WDATAINI
      @ 10,20 SAY "ENTRE COM A DATA FINAL  " GET M->WDATAFIM
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SET ORDER TO 1
      SET COLOR TO 11/4
      @ 02,03 SAY '¹ ORDEM DE DATA  Ì'
      SET COLOR TO 15/7,15/1
      SEEK DTOS(M->WDATAINI)
      M->WTOTAL=0
      M->WIMP = ''
      IF .NOT. IMP(24,@WIMP)
         MENSAG ("",24)
         RETURN 2
      ENDIF
      MENSAG ("AGUARDE TERMINO DE IMPRESSAO",24)
      M->WLIN = 65
      M->WPAG = 1
      * SET PRINTER TO &WIMP
      SET DEVICE TO PRINT
      SETPRC(0,0)
      DO WHILE DATA <= M->WDATAFIM
         IF GRUPO <> 'DOACAO COLAB' .AND. GRUPO <> 'DOACAO MEMBROS' .AND. GRUPO <> 'DOACAO BOLETIM'
            SKIP
            IF EOF()
               EXIT
            ENDIF
            LOOP
         ENDIF
         IF M->WLIN > 59
            M->WTITULO = 'ASSOCIACAO CORPUS CHRISTI  -  DOACOES'
            M->WTAM = LEN(M->WTITULO)
            @ 01,05 SAY DATE()
            @ 01,INT((132-M->WTAM)/2) SAY M->WTITULO
            @ 01,120 SAY 'PAG: '+STR(M->WPAG,2,0)
            @ 02,51 SAY 'DE: '+DTOC(M->WDATAINI)+ ' ATE: '+DTOC(M->WDATAFIM)
            @ 04,05 SAY 'DATA'
            @ 04,16 SAY 'REF.'
            @ 04,32 SAY 'NOME'
            @ 04,63 SAY 'DOCUMENTO'
            @ 04,96 SAY 'VALOR'
            M->WLIN=6
            M->WPAG = M->WPAG + 1
         ENDIF
         @ M->WLIN,05 SAY DATA
         @ M->WLIN,16 SAY GRUPO
         @ M->WLIN,32 SAY HISTORICO
         @ M->WLIN,63 SAY COMPL
         @ M->WLIN,89 SAY VALOR PICT '@E 9,999,999.99'
         M->WTOTAL=M->WTOTAL+VALOR
         M->WLIN = M->WLIN+1
         SKIP
         IF EOF()
            EXIT
         ENDIF
      ENDDO
      M->WLIN=M->WLIN+1
      @ M->WLIN,80 SAY 'TOTAL'
      @ M->WLIN,89 SAY M->WTOTAL PICT '@E 9,999,999.99'
      EJECT
      SET DEVICE TO SCREEN
      MENSAG ("",24)
      SEEK  DTOS(M->WDATAINI)
      RETURN 2
   ENDIF
ELSE
   RETURN 1
ENDIF
******************************************************************************
FUNCTION GRUPOCAD
SET CURSOR ON
PARAMETERS MODO
IF MODO = 4
   IF LASTKEY()= 27
      RETURN 0
   ELSEIF LASTKEY() = 279 && INCLUSAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (08,15,12,64,'NAO')
      M->WGRUPO = SPACE(15)
      M->WDESCRICAO = SPACE(30)
      M->WDEBCRED = SPACE(1)
      @ 09,17 SAY 'GRUPO.........' GET M->WGRUPO PICT '@!' VALID(M->WGRUPO <> SPACE(15))
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SEEK M->WGRUPO
      IF FOUND()
         ? CHR(7)
         MENSAG ('GRUPO JA CADASTRADO...',24)
         RETURN 2
      ENDIF
      @ 10,17 SAY 'DESCRICAO.....' GET M->WDESCRICAO PICT '@!' VALID(M->WDESCRICAO <> SPACE(30))
      @ 11,17 SAY '(D)EB / (C)RED' GET M->WDEBCRED PICT '@!' VALID(M->WDEBCRED $ 'DC')
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      APPEND BLANK
      REPLACE GRUPO WITH M->WGRUPO, DESCRICAO WITH M->WDESCRICAO, DEB_CRED WITH M->WDEBCRED
      COMMIT
      MENSAG ("INCLUSAO EFETUADA",24)
      RETURN 2
   ELSEIF LASTKEY() = 274 && EXCLUSAO
      M->WGRUPO=GRUPO
      SELE 1
      SET ORDER TO 2
      SET COLOR TO 11/4
      @ 02,03 SAY '¹ ORDEM DE GRUPO Ì'
      SET COLOR TO 15/7,15/1
      SEEK M->WGRUPO
      IF FOUND()
         ? CHR(7)
         MENSAG ('GRUPO NAO PODE SER EXCLUIDO. EXISTE(M) LANCAMENTO(S) CADASTRADO(S)',24)
         SELE 2
         SET ORDER TO 1
         RETURN 2
      ENDIF
      SELE 2
      SET ORDER TO 1
      IF CONFIRMA ('CONFIRMA EXCLUSAO ? <S/N>',24)
         DELE
         COMMIT
         MENSAG ("EXCLUSAO EFETUADA",24)
      ELSE
         MENSAG ('',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 28 && F1 - HELP
      MENSAG ('',24)
      QUADRO (08,27,11,51,"NAO")
      @ 09,29 SAY "ALT+I - INCLUIR"
      @ 10,29 SAY 'ALT+E - EXCLUIR'
      MENSAG ("TECLE ALGO PARA CONTINUAR",24)
      INKEY(0)
      MENSAG ('',24)
      RETURN 2
   ENDIF
ELSE
   RETURN 1
ENDIF
******************************************************************************
FUNCTION GRUPOREG
SET CURSOR ON
PARAMETERS MODO
IF MODO = 4
   IF LASTKEY()= 27
      RETURN 0
   ELSEIF LASTKEY() = 279 && INCLUSAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (08,15,11,58,'NAO')
      M->WREGIAO = RECCOUNT()+1
      M->WDESCRICAO = SPACE(25)
      @ 09,17 SAY 'REGIAO........' GET M->WREGIAO PICT '999' VALID(M->WREGIAO <> 0)
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SEEK STR(M->WREGIAO,3,0)
      IF FOUND()
         ? CHR(7)
         MENSAG ('REGIAO JA CADASTRADA...',24)
         RETURN 2
      ENDIF
      @ 10,17 SAY 'DESCRICAO.....' GET M->WDESCRICAO PICT '@!' VALID(M->WDESCRICAO <> SPACE(25))
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      APPEND BLANK
      REPLACE REGIAO WITH M->WREGIAO, DESCRICAO WITH M->WDESCRICAO
      COMMIT
      MENSAG ("INCLUSAO EFETUADA",24)
      RETURN 2
   ELSEIF LASTKEY() = 274 && EXCLUSAO
      M->WREGIAO=REGIAO
      SELE 3
      SET ORDER TO 1
      LOCATE FOR REGIAO = WREGIAO
      IF FOUND()
         ? CHR(7)
         MENSAG ('REGIAO NAO PODE SER EXCLUIDA. EXISTEM COLABORADORES CADASTRADOS',24)
         SELE 4
         RETURN 2
      ENDIF
      SELE 4
      IF CONFIRMA ('CONFIRMA EXCLUSAO ? <S/N>',24)
         DELE
         COMMIT
         MENSAG ("EXCLUSAO EFETUADA",24)
      ELSE
         MENSAG ('',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 28 && F1 - HELP
      MENSAG ('',24)
      QUADRO (08,27,11,51,"NAO")
      @ 09,29 SAY "ALT+I - INCLUIR"
      @ 10,29 SAY 'ALT+E - EXCLUIR'
      MENSAG ("TECLE ALGO PARA CONTINUAR",24)
      INKEY(0)
      MENSAG ('',24)
      RETURN 2
   ENDIF
ELSE
   RETURN 1
ENDIF
******************************************************************************
FUNCTION GRUPO
PARAMETERS WGRUPO, WCOMPL
SELE 2
SET ORDER TO 1
SEEK M->WGRUPO
IF FOUND()
   MENSAG ('',24)
   SELE 1
   RETURN .T.
ELSE
   MENSAG ('AGUARDE...',24)
   M->WTOTREC = RECCOUNT()
   DECLARE VETOR[M->WTOTREC]
   GO TOP
   FOR M->WIND = 1 TO M->WTOTREC
      VETOR[M->WIND] = GRUPO
      SKIP
   NEXT
   M->WTEL = SAVESCREEN (07,46,16,69)
   MENSAG ('ESCOLHA UM GRUPO CADASTRADO',24)
   QUADRO (07,46,16,69,'NAO')
   DO WHILE .T.
      M->WOPCAO = ACHOICE (08,48,15,67,VETOR)
      RESTSCREEN (07,46,16,69,M->WTEL)
      IF LASTKEY() = 13
         SET COLOR TO 15/1
         M->WGRUPO = VETOR[M->WOPCAO]
         @ 07,32 SAY M->WGRUPO
         SET COLOR TO 15/7,15/1
         MENSAG ('',24)
         SELE 1
         RETURN .T.
      ELSEIF LASTKEY() = 27
         MENSAG ('',24)
         SELE 1
         RETURN .F.
      ENDIF
   ENDDO
ENDIF
******************************************************************************
FUNCTION GRUPOCOLAB
SET CURSOR ON
PARAMETERS MODO
IF MODO = 4
   IF LASTKEY()= 27
      RETURN 0
   ELSEIF LASTKEY() = 279 && INCLUSAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (08,06,19,73,'NAO')
      M->WNOME = SPACE(30)
      M->WVINCULO = ' '
      M->WRESPONS = SPACE(15)
      M->WDOC1    = 'CPF                      '
      M->WDOC2    = 'RG                       '
      M->WENDERECO= SPACE(30)
      M->WBAIRRO  = SPACE(20)
      M->WCIDADE  = "SANTA BARBARA D'OESTE    "
      M->WCEP     = SPACE(9)
      M->WTELEFONE= SPACE(15)
      M->WEMAIL   = SPACE(30)
      M->WPAROQUIA= SPACE(15)
      M->WVALOR   = 0
      M->WDIA     = SPACE(2)
      M->WDATA    = DATE()
      M->WUF      = 'SP'
      M->WOBS     = SPACE(40)
      M->WDT_NASC = CTOD('  /  /    ')
      M->WULT_PG  = CTOD('  /  /    ')
      SET ORDER TO 3
      SET COLOR TO 11/4
      @ 05,06 SAY '¹ ORDEM DE NUMEROÌ'
      SET COLOR TO 15/7,15/1
      GO BOTTOM
      M->WNUMERO  = NUMERO+1
      M->WATIVO   = 'S'
      M->WREGIAO  = 0
      M->WFORMA = ' '
      M->WRECEBEDOR = 0
      @ 09,08 SAY 'NOME    :' GET M->WNOME PICT '@!' VALID(M->WNOME <> SPACE(30))
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SEEK M->WNOME
      IF FOUND()
         ? CHR(7)
         MENSAG ('ASSOCIADO JA CADASTRADO...',24)
         RETURN 2
      ENDIF
      @ 09,50 SAY 'N.:' GET M->WNUMERO PICT '99999'
      CLEAR GETS
      @ 09,61 SAY 'VINCULO :' GET M->WVINCULO VALID(VINCULO(@WVINCULO))
      @ 10,08 SAY 'RESP    :' GET M->WRESPONS PICT '@!'
      @ 10,40 SAY 'DOC 1:' GET M->WDOC1 PICT '@!'
      @ 11,08 SAY 'DOC 2   :' GET M->WDOC2 PICT '@!'
      @ 11,52 SAY 'DT.NASC.:' GET M->WDT_NASC PICT '@!'
      @ 12,08 SAY 'ENDERECO:' GET M->WENDERECO PICT '@!'
      @ 12,60 SAY 'REGIAO :' GET M->WREGIAO PICT '999' VALID(REGIAO(@WREGIAO))
      @ 13,08 SAY 'BAIRRO  :' GET M->WBAIRRO PICT '@!'
      @ 13,39 SAY 'CIDADE:' GET M->WCIDADE PICT '@!'
      @ 14,08 SAY 'UF      :' GET M->WUF PICT '@!'
      @ 14,27 SAY 'CEP:' GET M->WCEP PICT '99999-999'
      @ 14,47 SAY 'TELEFONE:' GET M->WTELEFONE PICT '@!'
      @ 15,08 SAY 'EMAIL   :' GET M->WEMAIL
      @ 15,50 SAY 'PAROQ:' GET M->WPAROQUIA PICT '@!'
      @ 16,08 SAY 'VALOR   :' GET M->WVALOR PICT '@E 9,999,999.99'
      @ 16,33 SAY 'DIA PG:' GET M->WDIA PICT '@!'
      @ 16,46 SAY 'FORMA:' GET M->WFORMA VALID(FORMA(@WFORMA))
      @ 16,58 SAY 'RECEBEDOR:' GET M->WRECEBEDOR PICT '999' VALID(RECEBEDOR(@WRECEBEDOR))
      @ 17,08 SAY 'ULT PGTO:' GET M->WULT_PG
      @ 17,35 SAY 'ATIVO?  :' GET M->WATIVO PICT '@!' VALID(M->WATIVO $ 'SN')
      @ 17,52 SAY 'DATA CAD:' GET M->WDATA PICT '@!'
      @ 18,08 SAY 'OBS.    :' GET M->WOBS PICT '@!'
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      IF CONFIRMA ('CONFIRMA INCLUSAO ? <S/N>',24)
         APPEND BLANK
         REPLACE NOME WITH M->WNOME, VINCULO WITH M->WVINCULO, RESPONS WITH M->WRESPONS,;
         DOC1 WITH M->WDOC1, DOC2 WITH M->WDOC2, ENDERECO WITH M->WENDERECO, BAIRRO WITH M->WBAIRRO,;
         CIDADE WITH M->WCIDADE, CEP WITH M->WCEP, TELEFONE WITH M->WTELEFONE, EMAIL WITH M->WEMAIL,;
         VALOR WITH M->WVALOR, PAROQUIA WITH M->WPAROQUIA, DIA WITH M->WDIA, DATA WITH M->WDATA, UF WITH M->WUF,;
         NUMERO WITH M->WNUMERO, ATIVO WITH M->WATIVO, REGIAO WITH M->WREGIAO, FORMA_PGTO WITH M->WFORMA,;
         RECEBEDOR WITH M->WRECEBEDOR, OBS WITH M->WOBS, DATA_NASC WITH M->WDT_NASC, ULT_PGTO WITH M->WULT_PG
         COMMIT
         MENSAG ("INCLUSAO EFETUADA",24)
      ENDIF
      MENSAG ('',24)
      RETURN 2
   ELSEIF LASTKEY() = 286 && ALTERACAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (08,06,19,73,'NAO')
      M->WNOME = NOME
      M->WVINCULO = VINCULO
      M->WRESPONS = RESPONS
      M->WDOC1    = DOC1
      M->WDOC2    = DOC2
      M->WENDERECO= ENDERECO
      M->WBAIRRO  = BAIRRO
      M->WCIDADE  = CIDADE
      M->WCEP     = CEP
      M->WTELEFONE= TELEFONE
      M->WEMAIL   = EMAIL
      M->WPAROQUIA= PAROQUIA
      M->WVALOR   = VALOR
      M->WDIA     = DIA
      M->WDATA    = DATA
      M->WUF      = UF
      M->WNUMERO  = NUMERO
      M->WATIVO   = ATIVO
      M->WREGIAO  = REGIAO
      M->WFORMA   = FORMA_PGTO
      M->WULT_PG  = ULT_PGTO
      M->WRECEBEDOR = RECEBEDOR
      M->WOBS = OBS
      M->WDT_NASC = DATA_NASC
      @ 09,08 SAY 'NOME    :' GET M->WNOME PICT '@!' VALID(M->WNOME <> SPACE(30))
      @ 09,50 SAY 'N.:' GET M->WNUMERO PICT '99999'
      @ 09,61 SAY 'VINCULO :' GET M->WVINCULO PICT '@!' VALID(M->WVINCULO $ 'AMC')
      @ 10,08 SAY 'RESP    :' GET M->WRESPONS PICT '@!'
      @ 10,40 SAY 'DOC 1:' GET M->WDOC1 PICT '@!'
      @ 11,08 SAY 'DOC 2   :' GET M->WDOC2 PICT '@!'
      @ 11,52 SAY 'DT.NASC.:' GET M->WDT_NASC PICT '@!'
      @ 12,08 SAY 'ENDERECO:' GET M->WENDERECO PICT '@!'
      @ 12,60 SAY 'REGIAO :' GET M->WREGIAO PICT '999' VALID(REGIAO(@WREGIAO))
      @ 13,08 SAY 'BAIRRO  :' GET M->WBAIRRO PICT '@!'
      @ 13,39 SAY 'CIDADE:' GET M->WCIDADE PICT '@!'
      @ 14,08 SAY 'UF      :' GET M->WUF PICT '@!'
      @ 14,27 SAY 'CEP:' GET M->WCEP PICT '@!'
      @ 14,47 SAY 'TELEFONE:' GET M->WTELEFONE PICT '@!'
      @ 15,08 SAY 'EMAIL   :' GET M->WEMAIL
      @ 15,50 SAY 'PAROQ:' GET M->WPAROQUIA PICT '@!'
      @ 16,08 SAY 'VALOR   :' GET M->WVALOR PICT '@E 9,999,999.99'
      @ 16,33 SAY 'DIA PG:' GET M->WDIA PICT '@!'
      @ 16,46 SAY 'FORMA:' GET M->WFORMA  PICT '@!' VALID(M->WFORMA $ '123')
      @ 16,58 SAY 'RECEBEDOR:' GET M->WRECEBEDOR PICT '999'
      @ 17,08 SAY 'ULT PGTO:' GET M->WULT_PG
      @ 17,35 SAY 'ATIVO?:' GET M->WATIVO PICT '@!' VALID(M->WATIVO $ 'SN')
      @ 17,52 SAY 'DATA CAD:' GET M->WDATA PICT '@!'
      @ 18,08 SAY 'OBS.    :' GET M->WOBS PICT '@!'
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      REPLACE NOME WITH M->WNOME, VINCULO WITH M->WVINCULO, RESPONS WITH M->WRESPONS,;
      DOC1 WITH M->WDOC1, DOC2 WITH M->WDOC2, ENDERECO WITH M->WENDERECO, BAIRRO WITH M->WBAIRRO,;
      CIDADE WITH M->WCIDADE, CEP WITH M->WCEP, TELEFONE WITH M->WTELEFONE, EMAIL WITH M->WEMAIL,;
      VALOR WITH M->WVALOR, PAROQUIA WITH M->WPAROQUIA, DIA WITH M->WDIA, DATA WITH M->WDATA, UF WITH M->WUF,;
      NUMERO WITH M->WNUMERO, ATIVO WITH M->WATIVO, REGIAO WITH M->WREGIAO, FORMA_PGTO WITH M->WFORMA,;
      ULT_PGTO WITH M->WULT_PG, RECEBEDOR WITH M->WRECEBEDOR, OBS WITH M->WOBS, DATA_NASC WITH M->WDT_NASC
      COMMIT
      MENSAG ("ALTERACAO EFETUADA",24)
      MENSAG ('',24)
      RETURN 2
   ELSEIF LASTKEY() = 301 && EXPORTACAO
      IF CONFIRMA ('CONFIRMA EXPORTACAO ? <S/N>',24)
         MENSAG ('AGUARDE...',24)
         COPY TO C:\COLAB.TXT FIELDS ATIVO,NUMERO,VINCULO,NOME,REGIAO,ENDERECO,BAIRRO,CIDADE,TELEFONE,EMAIL,VALOR,DIA,FORMA_PGTO,RECEBEDOR,OBS,DATA_NASC DELIMITED
         MENSAG ("EXPORTACAO EFETUADA. UTILIZE O ARQUIVO C:\COLAB.TXT",24)
      ELSE
         MENSAG ('',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 274 && EXCLUSAO
      IF CONFIRMA ('CONFIRMA EXCLUSAO ? <S/N>',24)
         DELE
         COMMIT
         MENSAG ("EXCLUSAO EFETUADA",24)
      ELSE
         MENSAG ('',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 294 && ALT+L - LISTAGEM DOS ASSOCIADOS
      M->WIMP = ''
      IF .NOT. IMP(24,@WIMP)
         MENSAG ("",24)
         RETURN 2
      ENDIF
      MENSAG ("AGUARDE TERMINO DE IMPRESSAO",24)
      M->WLIN = 65
      M->WPAG = 1
      * SET PRINTER TO &WIMP
      SET DEVICE TO PRINT
      SETPRC(0,0)
      GO TOP
      DO WHILE .NOT. EOF()
         IF VINCULO<>'A' .OR. ATIVO='N'
            SKIP
            LOOP
         ENDIF
         IF M->WLIN > 59
            M->WTITULO = 'ASSOCIACAO CORPUS CHRISTI - ASSOCIADOS'
            M->WTAM = LEN(M->WTITULO)
            @ 01,05 SAY DATE()
            @ 01,INT((132-M->WTAM)/2) SAY M->WTITULO
            @ 01,120 SAY 'PAG: '+STR(M->WPAG,2,0)
            @ 03,05 SAY 'NUM.'
            @ 03,11 SAY 'NOME'
            @ 03,42 SAY 'RESPONSAVEL'
            @ 03,65 SAY 'VALOR'
            @ 03,71 SAY 'DIA_PGTO'
            @ 03,80 SAY 'FORMA'
            @ 03,86 SAY 'ULT_PGTO'
            @ 04,05 SAY 'ENDERECO'
            @ 04,36 SAY 'BAIRRO'
            @ 04,57 SAY 'CIDADE'
            @ 04,83 SAY 'REGIAO'
            @ 04,90 SAY 'TELEFONE'
            M->WLIN=6
            M->WPAG = M->WPAG + 1
         ENDIF
         @ M->WLIN,05 SAY NUMERO PICT '99999'
         @ M->WLIN,11 SAY NOME
         @ M->WLIN,42 SAY RESPONS
         @ M->WLIN,58 SAY VALOR PICT '@E 9,999,999.99'
         @ M->WLIN,74 SAY DIA
         @ M->WLIN,82 SAY FORMA_PGTO
         @ M->WLIN,86 SAY ULT_PGTO
         M->WLIN=M->WLIN+1
         @ M->WLIN,05 SAY ENDERECO
         @ M->WLIN,36 SAY BAIRRO
         @ M->WLIN,57 SAY CIDADE
         @ M->WLIN,85 SAY REGIAO
         @ M->WLIN,90 SAY TELEFONE
         M->WLIN = M->WLIN+2
         SKIP
      ENDDO
      EJECT
      SET DEVICE TO SCREEN
      MENSAG ("",24)
      RETURN 2
   ELSEIF LASTKEY() = 275 && ALT+R - LISTAGEM DO RECIBO
      SET ORDER TO 3
      SET COLOR TO 11/4
      @ 05,06 SAY '¹ ORDEM DE NUMEROÌ'
      SET COLOR TO 15/7,15/1
      M->WDIAINI = 0
      M->WDIAFIM = 0
      M->WFORMA = "1"
      M->WRECEB = 0
      M->WPERIODO = SPACE(20)
      M->WAPARTIR1 = 0
      M->WAPARTIR2 = 99999
      QUADRO (08,18,14,60,'NAO')
      @ 09,20 SAY "PAGAMENTO NOS DIAS: DE" GET M->WDIAINI PICT "99" RANGE 1,31
      @ 09,47 SAY "ATE:" GET M->WDIAFIM PICT "99" RANGE 1,31
      @ 10,20 SAY "FORMA DE PAGAMENTO:" GET M->WFORMA PICT "9"
      @ 11,20 SAY "RECEBEDOR:" GET M->WRECEB PICT "999" VALID(RECEB(WRECEB))
      @ 12,20 SAY "PERIODO:" GET M->WPERIODO PICT "@!"
      @ 13,20 SAY "ASSOCIADO DE:" GET M->WAPARTIR1 PICT "99999" VALID(COLAB1(WAPARTIR1))
      @ 13,40 SAY "ATE:" GET M->WAPARTIR2 PICT "99999" VALID(COLAB2(WAPARTIR2))
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      IF M->WAPARTIR1 > M->WAPARTIR2
         MENSAG ("NUMERO FINAL NAO PODE SER MENOR QUE INICIAL",24)
         RETURN 2
      ENDIF
      * ADILSON EM OUT 2014 (IMPRIMIR NOME DO RECEBEDOR NO RECIBO)
      SELE 6
      SEEK STR(M->WRECEB,3,0)
      M->WNOMEREC = NOME
      SELE 3
      GO TOP
      M->WIMP = ''
      IF .NOT. IMP(24,@WIMP)
         MENSAG ("",24)
         RETURN 2
      ENDIF
      MENSAG ("AGUARDE TERMINO DE IMPRESSAO",24)
      * SET PRINTER TO &WIMP
      SET DEVICE TO PRINT
      SETPRC(0,0)
      M->WLIN = 0
      DO WHILE .NOT. EOF()
         IF VINCULO="A" .AND. RECEBEDOR=M->WRECEB .AND. ATIVO="S" .AND. VAL(DIA) >= M->WDIAINI .AND. VAL(DIA) <= M->WDIAFIM .AND. FORMA_PGTO=M->WFORMA .AND. NUMERO >= M->WAPARTIR1 .AND. NUMERO <= M->WAPARTIR2
            @ M->WLIN,03 SAY 'ASSOCIACAO CORPUS CHRISTI'
            @ M->WLIN,35 SAY 'REC: '+M->WNOMEREC
            M->WLIN = M->WLIN+1
            @ M->WLIN,03 SAY "RUA FLORIANO PEIXOTO, 1060 - VILA BREDA"
            M->WLIN = M->WLIN+1
            @ M->WLIN,03 SAY "SANTA BARBARA D'OESTE-SP"
            M->WLIN = M->WLIN+1
            @ M->WLIN,03 SAY "CNPJ 05.951.278/0001-68"
            M->WLIN = M->WLIN+2
            @ M->WLIN,33 SAY "R E C I B O"
            M->WLIN = M->WLIN+2
            @ M->WLIN,03 SAY "RECEBEMOS DE "+RTRIM(NOME)+", "+DOC1
            M->WLIN = M->WLIN+1
            @ M->WLIN,03 SAY RTRIM(ENDERECO)+", "+RTRIM(BAIRRO)+" TEL: "+RTRIM(TELEFONE)+" REG: "+STRZERO(REGIAO)
            M->WLIN = M->WLIN+1
            @ M->WLIN,03 SAY "A QUANTIA DE "+TRANSFORM(VALOR,'@E 99,999.99')
            M->WLIN = M->WLIN+1
            @ M->WLIN,03 SAY "REFERENTE A DOACAO ESPONTANEA DE "+M->WPERIODO
            M->WLIN = M->WLIN+3
            @ M->WLIN,03 SAY "SANTA BARBARA D'OESTE, "+DIA+"/"+RTRIM(M->WPERIODO)
            @ M->WLIN,47 SAY "_________________________"
            M->WLIN = M->WLIN+1
            @ M->WLIN,47 SAY "ASSOCIACAO CORPUS CHRISTI"
            M->WLIN = M->WLIN+1
            @ M->WLIN,03 SAY OBS
            M->WLIN = M->WLIN+2
            @ M->WLIN,03 SAY REPLICATE("-",70)
            M->WLIN = M->WLIN+3
            IF M->WLIN > 59
               M->WLIN=0
            ENDIF
         ENDIF
         SKIP
      ENDDO
      EJECT
      SET DEVICE TO SCREEN
      MENSAG ("",24)
      RETURN 2
   ELSEIF LASTKEY() = 276 && ALT+T - TROCAR INDICE
      IF INDEXORD() = 1
         SET ORDER TO 2
         SET COLOR TO 11/4
         @ 05,06 SAY '¹ ORDEM DE REGIAOÌ'
         SET COLOR TO 15/7,15/1
      ELSEIF INDEXORD() = 2
         SET ORDER TO 3
         SET COLOR TO 11/4
         @ 05,06 SAY '¹ ORDEM DE NUMEROÌ'
         SET COLOR TO 15/7,15/1
      ELSEIF INDEXORD() = 3
         SET ORDER TO 1
         SET COLOR TO 11/4
         @ 05,06 SAY '¹ ORDEM DE NOME  Ì'
         SET COLOR TO 15/7,15/1
      ENDIF
      GO TOP
      RETURN 2
   ELSEIF LASTKEY() = 281 && PESQUISA
      QUADRO (08,18,10,59,'NAO')
      IF INDEXORD() = 1
         M->WNOME = SPACE(30)
         @ 09,20 SAY 'NOME : ' GET M->WNOME PICT '@!'
         READ
         SEEK M->WNOME
      ELSEIF INDEXORD() = 2
         M->WREGIAO = 0
         @ 09,20 SAY 'REGIAO.....................: ' GET M->WREGIAO PICT '999'
         READ
         SEEK STR(M->WREGIAO,3,0)
      ELSEIF INDEXORD() = 3
         M->WNUMERO = 0
         @ 09,20 SAY 'NUMERO...................: ' GET M->WNUMERO PICT '99999'
         READ
         SEEK STR(M->WNUMERO,5,0)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 28 && F1 - HELP
      MENSAG ('',24)
      QUADRO (08,27,17,52,"NAO")
      @ 09,29 SAY "ALT+I - INCLUIR"
      @ 10,29 SAY 'ALT+E - EXCLUIR'
      @ 11,29 SAY 'ALT+A - ALTERAR'
      @ 12,29 SAY 'ALT+L - LISTAR SOCIOS'
      @ 13,29 SAY 'ALT+R - LISTAR RECIBOS'
      @ 14,29 SAY 'ALT+T - TROCAR INDICE'
      @ 15,29 SAY 'ALT+P - PESQUISAR'
      @ 16,29 SAY 'ALT+X - EXPORTAR'
      MENSAG ("TECLE ALGO PARA CONTINUAR",24)
      INKEY(0)
      MENSAG ('',24)
      RETURN 2
   ENDIF
ELSE
   RETURN 1
ENDIF
******************************************************************************
FUNCTION COLAB
PARAMETERS WGRUPO, WHISTORICO, WCOMPL, WVALOR
IF M->WGRUPO<>"DOACAO MEMBROS" .AND. M->WGRUPO<>"MENSAL ASSOC" .AND. M->WGRUPO<>"ATENDIMENTO"
   SELE 1
   RETURN .T.
ENDIF
IF LEN(RTRIM(M->WHISTORICO))=0
   MENSAG ('PREENCHIMENTO OBRIGATORIO',24)
   SELE 1
   RETURN .F.
ENDIF
SELE 3
SET ORDER TO 1
SEEK M->WHISTORICO
IF FOUND()
   M->WVALOR=VALOR
   IF M->WGRUPO="DOACAO MEMBROS" .OR. M->WGRUPO="ATENDIMENTO"
      M->WCOMPL=DOC1
   ELSE
      M->WCOMPL=SUBSTR(DTOC(DATE()),4,7)+SPACE(18)
   ENDIF
ELSE
   M->WTAM = LEN(RTRIM(M->WHISTORICO))
   M->WTOTREC = RECCOUNT()
   DECLARE VETOR[M->WTOTREC]
   M->WIND = 0
   DO WHILE SUBSTR(NOME,1,M->WTAM) = RTRIM(M->WHISTORICO)
      M->WIND = M->WIND + 1
      VETOR[M->WIND] = SUBSTR(NOME,1,30)+' - '+TRANSFORM(VALOR,'@E 9,999,999.99')
      SKIP
   ENDDO
   IF M->WIND = 0
      MENSAG ('NOME NAO LOCALIZADO',24)
      SELE 1
      RETURN .F.
   ENDIF
   M->WTEL1 = SAVESCREEN (07,25,16,73)
   MENSAG ('TECLE <ENTER> NO NOME DESEJADO',24)
   QUADRO (07,25,16,73,'NAO')
   M->WOPCAO = ACHOICE (08,27,15,71,VETOR)
   RESTSCREEN (07,25,16,73,M->WTEL1)
   IF LASTKEY()=27
      SELE 1
      MENSAG ('',24)
      RETURN .F.
   ENDIF
   IF LASTKEY() = 13
      M->WHISTORICO = SUBSTR(VETOR[M->WOPCAO],1,30)
      SEEK M->WHISTORICO
      SET COLOR TO 15/1,15/7
      @ 08,32 SAY M->WHISTORICO
      SET COLOR TO 15/7,15/1
      M->WVALOR = VALOR
      IF M->WGRUPO="DOACAO MEMBROS" .OR. M->WGRUPO="ATENDIMENTO"
         M->WCOMPL=DOC1
      ELSE
         M->WCOMPL=SUBSTR(DTOC(DATE()),4,7)+SPACE(18)
      ENDIF
   ENDIF
ENDIF
MENSAG ('',24)
SELE 1
RETURN .T.
*****************************************************************************
FUNCTION REGIAO
PARAMETERS WREGIAO
SELE 4
SET ORDER TO 1
SEEK STR(M->WREGIAO,3,0)
IF FOUND()
   MENSAG ('',24)
   SELE 3
   RETURN .T.
ELSE
   MENSAG ('AGUARDE...',24)
   M->WTOTREC = RECCOUNT()
   DECLARE VETOR[M->WTOTREC]
   GO TOP
   FOR M->WIND = 1 TO M->WTOTREC
      VETOR[M->WIND] = DESCRICAO+' - '+STR(REGIAO,3,0)
      SKIP
   NEXT
   M->WTEL = SAVESCREEN (07,30,16,67)
   MENSAG ('ESCOLHA UMA REGIAO',24)
   QUADRO (07,30,16,67,'NAO')
   DO WHILE .T.
      M->WOPCAO = ACHOICE (08,32,15,65,VETOR)
      RESTSCREEN (07,30,16,67,M->WTEL)
      IF LASTKEY() = 13
         SET COLOR TO 15/1
         M->WREGIAO = SUBSTR(VETOR[M->WOPCAO],29,3)
         @ 12,69 SAY M->WREGIAO
         M->WREGIAO = VAL(M->WREGIAO)
         SET COLOR TO 15/7,15/1
         MENSAG ('',24)
         SELE 3
         RETURN .T.
      ELSEIF LASTKEY() = 27
         MENSAG ('',24)
         SELE 3
         RETURN .F.
      ENDIF
   ENDDO
ENDIF
******************************************************************************
FUNCTION VINCULO
PARAMETERS WVINCULO
DECLARE VETOR[3]
VETOR[1] = 'ASSOCIADO'
VETOR[2] = 'MEMBRO'
VETOR[3] = 'COLABORADOR'
M->WTEL = SAVESCREEN (07,50,11,67)
MENSAG ('ESCOLHA UM VINCULO',24)
QUADRO (07,50,11,67,'NAO')
DO WHILE .T.
   M->WOPCAO = ACHOICE (08,52,10,65,VETOR)
   RESTSCREEN (07,50,11,67,M->WTEL)
   IF LASTKEY() = 13
      SET COLOR TO 15/1
      M->WVINCULO = SUBSTR(VETOR[M->WOPCAO],1,1)
      @ 09,71 SAY M->WVINCULO
      SET COLOR TO 15/7,15/1
      MENSAG ('',24)
      RETURN .T.
   ELSEIF LASTKEY() = 27
      MENSAG ('',24)
      RETURN .F.
   ENDIF
ENDDO
******************************************************************************
FUNCTION FORMA
PARAMETERS WFORMA
DECLARE VETOR[3]
VETOR[1] = '1-RECEBER'
VETOR[2] = '2-PAGA NA COM'
VETOR[3] = '3-DEPOSITA CC'
M->WTEL = SAVESCREEN (15,53,19,70)
MENSAG ('ESCOLHA UMA FORMA',24)
QUADRO (15,53,19,70,'NAO')
DO WHILE .T.
   M->WOPCAO = ACHOICE (16,55,18,68,VETOR)
   RESTSCREEN (15,53,19,70,M->WTEL)
   IF LASTKEY() = 13
      SET COLOR TO 15/1
      M->WFORMA = SUBSTR(VETOR[M->WOPCAO],1,1)
      @ 16,53 SAY M->WFORMA
      SET COLOR TO 15/7,15/1
      MENSAG ('',24)
      RETURN .T.
   ELSEIF LASTKEY() = 27
      MENSAG ('',24)
      RETURN .F.
   ENDIF
ENDDO
******************************************************************************
FUNCTION GRUPOBAL
SET CURSOR ON
PARAMETERS MODO
IF MODO = 4
   IF LASTKEY()= 27
      RETURN 0
   ENDIF
ELSE
   RETURN 1
ENDIF
******************************************************************************
FUNCTION RECEBEDOR
PARAMETERS WRECEBEDOR
SELE 6
SET ORDER TO 1
SEEK STR(M->WRECEBEDOR,3,0)
IF FOUND()
   MENSAG ('',24)
   SELE 3
   RETURN .T.
ELSE
   MENSAG ('AGUARDE...',24)
   M->WTOTREC = RECCOUNT()
   DECLARE VETOR[M->WTOTREC]
   GO TOP
   FOR M->WIND = 1 TO M->WTOTREC
      VETOR[M->WIND] = NOME+' - '+STR(RECEBEDOR,3,0)
      SKIP
   NEXT
   M->WTEL = SAVESCREEN (07,30,16,67)
   MENSAG ('ESCOLHA UM RECEBEDOR',24)
   QUADRO (07,30,16,67,'NAO')
   DO WHILE .T.
      M->WOPCAO = ACHOICE (08,32,15,65,VETOR)
      RESTSCREEN (07,30,16,67,M->WTEL)
      IF LASTKEY() = 13
         SET COLOR TO 15/1
         M->WRECEBEDOR = SUBSTR(VETOR[M->WOPCAO],29,3)
         @ 16,69 SAY M->WRECEBEDOR
         M->WRECEBEDOR = VAL(M->WRECEBEDOR)
         SET COLOR TO 15/7,15/1
         MENSAG ('',24)
         SELE 3
         RETURN .T.
      ELSEIF LASTKEY() = 27
         MENSAG ('',24)
         SELE 3
         RETURN .F.
      ENDIF
   ENDDO
ENDIF
******************************************************************************
FUNCTION GRUPOREC
SET CURSOR ON
PARAMETERS MODO
IF MODO = 4
   IF LASTKEY()= 27
      RETURN 0
   ELSEIF LASTKEY() = 279 && INCLUSAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (08,15,11,58,'NAO')
      M->WRECEBEDOR = RECCOUNT()+1
      M->WNOME = SPACE(25)
      @ 09,17 SAY 'RECEBEDOR.....' GET M->WRECEBEDOR PICT '999' VALID(M->WRECEBEDOR <> 0)
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      SEEK STR(M->WRECEBEDOR,3,0)
      IF FOUND()
         ? CHR(7)
         MENSAG ('RECEBEDOR JA CADASTRADO...',24)
         RETURN 2
      ENDIF
      @ 10,17 SAY 'NOME..........' GET M->WNOME PICT '@!' VALID(M->WNOME <> SPACE(25))
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      APPEND BLANK
      REPLACE RECEBEDOR WITH M->WRECEBEDOR, NOME WITH M->WNOME
      COMMIT
      MENSAG ("INCLUSAO EFETUADA",24)
      RETURN 2
   ELSEIF LASTKEY() = 286 && ALTERACAO
      MENSAG ('ENTRE COM OS DADOS',24)
      QUADRO (08,15,11,58,'NAO')
      M->WRECEBEDOR=RECEBEDOR
      M->WNOME = NOME
      @ 09,17 SAY 'RECEBEDOR.....' GET M->WRECEBEDOR
      CLEAR GETS
      @ 10,17 SAY 'NOME..........' GET M->WNOME PICT '@!' VALID(M->WNOME <> SPACE(25))
      READ
      IF LASTKEY() = 27
         MENSAG ('',24)
         RETURN 2
      ENDIF
      REPLACE NOME WITH M->WNOME
      COMMIT
      MENSAG ("ALTERACAO EFETUADA",24)
      RETURN 2
   ELSEIF LASTKEY() = 274 && EXCLUSAO
      M->WRECEBEDOR=RECEBEDOR
      SELE 3
      SET ORDER TO 1
      LOCATE FOR RECEBEDOR = WRECEBEDOR
      IF FOUND()
         ? CHR(7)
         MENSAG ('RECEBEDOR NAO PODE SER EXCLUIDO. EXISTEM COLABORADORES CADASTRADOS',24)
         SELE 6
         RETURN 2
      ENDIF
      SELE 6
      IF CONFIRMA ('CONFIRMA EXCLUSAO ? <S/N>',24)
         DELE
         COMMIT
         MENSAG ("EXCLUSAO EFETUADA",24)
      ELSE
         MENSAG ('',24)
      ENDIF
      RETURN 2
   ELSEIF LASTKEY() = 28 && F1 - HELP
      MENSAG ('',24)
      QUADRO (08,27,12,51,"NAO")
      @ 09,29 SAY "ALT+I - INCLUIR"
      @ 10,29 SAY "ALT+A - ALTERAR"
      @ 11,29 SAY 'ALT+E - EXCLUIR'
      MENSAG ("TECLE ALGO PARA CONTINUAR",24)
      INKEY(0)
      MENSAG ('',24)
      RETURN 2
   ENDIF
ELSE
   RETURN 1
ENDIF
******************************************************************************
FUNCTION COLAB1
PARAMETERS WAPARTIR1
IF M->WAPARTIR1 <> 0 
   SEEK STR(M->WAPARTIR1,5,0)
   IF FOUND()
      MENSAG ('',24)
      RETURN .T.
   ELSE
      MENSAG ('COLABORADOR NAO CADASTRADO',24)
      RETURN .F.
   ENDIF
ELSE
  RETURN .T.
ENDIF
******************************************************************************
FUNCTION COLAB2
PARAMETERS WAPARTIR2
IF M->WAPARTIR2 <> 99999
   SEEK STR(M->WAPARTIR2,5,0)
   IF FOUND()
      MENSAG ('',24)
      RETURN .T.
   ELSE
      MENSAG ('COLABORADOR NAO CADASTRADO',24)
      RETURN .F.
   ENDIF
ELSE
  RETURN .T.
ENDIF
******************************************************************************
FUNCTION RECEB
PARAMETERS WRECEB
SELE 6
SEEK STR(M->WRECEB,3,0)
IF FOUND()
   @ 11,35 SAY NOME
   MENSAG ('',24)
   SELE 3
   SET ORDER TO 3
   RETURN .T.
ELSE
   @ 11,35 SAY SPACE(25)
   MENSAG ('RECEBEDOR NAO CADASTRADO...',24)
   SELE 3
   SET ORDER TO 3
   RETURN .F.
ENDIF
******************************************************************************
